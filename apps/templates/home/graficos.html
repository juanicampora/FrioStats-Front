{% extends "layouts/base.html" %} {% block title %} Gráficos {% endblock %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
/>
{% endblock stylesheets %} {% block content %}
<div class="pcoded-main-container">
  <div class="pcoded-wrapper">
    <div class="pcoded-content">
      <div class="pcoded-inner-content">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
          <div class="page-block">
            <div class="row align-items-center">
              <div class="col-md-12">
                <ul class="breadcrumb">
                  <li class="breadcrumb-item">
                    <a href="/"><i class="feather icon-home"></i></a>
                  </li>
                  <li class="breadcrumb-item">
                    <a href="/panel/{{idSucursal}}">Panel</a>
                  </li>
                  <li class="breadcrumb-item">Gráfico</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <div class="main-body">
          <div class="page-wrapper">
            <div class="row">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-header">
                    <h5>Gráfico {{descParametro}}</h5>
                  </div>
                  <div class="card-block">
                    <canvas id="myChart"></canvas>
                    <script>
                      var ctx = document.getElementById('myChart').getContext('2d');
                      var myChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                          labels: {{ labels | safe }},
                          datasets: [
                            {
                              label: 'Temperatura',
                              data: {{ values | safe }},
                              fill: false,
                              borderColor: 'rgb(4, 169, 245)',
                              borderWidth: 6,
                              cubicInterpolationMode: 'monotone',
                              tension: 0.4
                            },
                          ],
                        }
                      });
                    </script>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %} {% block javascripts %}

<script>
  function guardar() {
    var parametro = '{{ parametro }}';
    var bodyData = {};
    let maximo = parametro.replace('sensor', 'max');
    bodyData[maximo] = parseInt(document.getElementById('maximo').value);
    if (document.getElementById('minimo').value != '') {
      let minimo = parametro.replace('sensor', 'min');
      bodyData[minimo] = parseInt(document.getElementById('minimo').value);
    }
    // encerrar cada indice de bodydata entre ''
    bodyData = JSON.stringify(bodyData).replace(/"([^"]+)":/g, '"$1":');
    var myHeaders = new Headers();
    var userToken = getCookie('token'); // Obtener el token de la cookie
    myHeaders.append('user-token', userToken);
    console.log(bodyData);
    console.log(myHeaders.get('user-token'));
    fetch('http://ljragusa.com.ar:3001/parameters/{{idMaquina}}', {
      method: 'PATCH',
      headers: myHeaders,
      body: bodyData,
    })
      .then((response) => {
        console.log(response);
        console.log('Guardadooooooooooooo');
        //                                                                  MANDAR A PANEL
        //window.location.href = '/panel/{{idSucursal}}';
      })
      .catch((error) => {
        console.log(error);
        window.location.href = '/error';
      });
  }

  function getCookie(name) {
    var value = '; ' + document.cookie;
    var parts = value.split('; ' + name + '=');
    if (parts.length === 2) return parts.pop().split(';').shift();
  }
</script>

{% endblock javascripts %}
