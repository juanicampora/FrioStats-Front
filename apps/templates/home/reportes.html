{% extends "layouts/base.html" %} {% block title %} Reportes {% endblock %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<style>
  .table tbody tr,
  .table tbody td {
    padding: 0.25rem;
    /* Reduce padding */
    height: 1.5rem;
    /* Reduce row height */
  }
</style>
{% endblock stylesheets %} {% block content %}
<div class="pcoded-main-container">
  <div class="pcoded-wrapper">
    <div class="pcoded-content" style="padding-top: 10px;">
      <div class="pcoded-inner-content">
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
          <div class="page-block">
            <div class="row align-items-center">
              <div class="col-md-12">
                <ul class="breadcrumb" style="margin-bottom: 0px;">
                  <li class="breadcrumb-item">
                    <a href="/"><i class="feather icon-home"></i></a>
                  </li>
                  <li class="breadcrumb-item">
                    <a href="/reportes">Período y Sucursal Reporte</a>
                  </li>
                  <li class="breadcrumb-item">Reporte</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <div class="main-body">
          <div class="page-wrapper">
            <div class="row">
              {% if datosP['message']== 'No se encontraron mediciones para esa fecha' %}
              <div class="col-md-12">
                <div class="card">
                  <div class="card-block">
                    <p class="text-warning" style="font-size: large;"><i class="feather icon-alert-circle"
                        style="color: #ffc107"></i> No hay datos de la máquina {{idMaquina}} para graficar de ese
                      período</p>
                  </div>
                </div>
              </div>
              {% else %}
              <div class="col-md-12">
                <div class="container">
                  <h1 style="text-align: center;margin-bottom: 20px;"> Reporte de la Sucursal {{idSucursal}}</h1>
                  <div class="row mb-4" style="display: flex;justify-content: center; font-size: large;">
                    <div class="col-md-3">
                      <table class="table table-striped">
                        <thead style="background-color: gray;">
                          <tr>
                            <th scope="col">Máquina</th>
                            <th scope="col">Notificaciones Graves</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in range(datosP.labelsGrave | length) %}
                          <tr>
                            <td>{{ datosP.labelsGrave[i] }}</td>
                            <td>{{ datosP.valueGrave[i] }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                    <div class="col-md-3">
                      <table class="table table-striped">
                        <thead style="background-color: gray;">
                          <tr>
                            <th scope="col">Máquina</th>
                            <th scope="col">Notificaciones Leves</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in range(datosP.labelsLeve | length) %}
                          <tr>
                            <td>{{ datosP.labelsLeve[i] }}</td>
                            <td>{{ datosP.valueLeve[i] }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div class="row mb-4" style="display: flex;justify-content: center;">
                    <div class="col">
                      <h4 style="text-align: center;text-decoration: underline;margin-bottom: 10px;">Notificaciones
                        Graves por Máquina</h4>
                      <canvas id="gNotiGrave"></canvas>
                    </div>
                    <div class="col">
                      <h4 style="text-align: center;text-decoration: underline; margin-bottom: 10px;">Notificaciones
                        Graves por Máquina</h4>
                      <canvas id="gNotiLeve"></canvas>
                    </div>
                  </div>
                  <div class="row mb-4">
                    <div class="col">
                      <canvas id="gConsumo"></canvas>
                    </div>
                    <div class="col">
                      <canvas id="gCooler"></canvas>
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
{% block javascripts %}
<script>
  const theme = localStorage.getItem("theme"); // Get the theme from darkmode.js
  const textColor = theme === "dark" ? "white" : "dark"; // Set text color based on theme
  var ctx1 = document.getElementById('gNotiGrave').getContext('2d');
  var gNotiGrave = new Chart(ctx1, {
    type: 'pie',
    data: {
      labels: {{ datosP.labelsGrave | safe }},
  datasets: [{
    label: 'Cantidad de notificaciones graves', color: textColor,
    data: {{ datosP.valueGrave | safe }}    
      },],},
  options: {
    plugins: {
      legend: {
        labels: {
          color: textColor,
        },
      },
    },
    scales: {
      x: { ticks: { color: textColor }, grid: { color: '#85929E' } },
      y: { title: { display: true, color: textColor, text: 'Notificaciones graves' } , ticks: { color: textColor }, grid: { color: '#85929E' } }
    }

  }
  });
  var ctx2 = document.getElementById('gNotiLeve').getContext('2d');
  var gNotiLeve = new Chart(ctx2, {
    type: 'pie',
    data: {
      labels: {{ datosP.labelsLeve | safe }},
  datasets: [{
    label: 'Cantidad de notificaciones leves por máquina',
    data: {{ datosP.valueLeve | safe }},
        },],},
  options: {
    plugins: {
      legend: {
        labels: {
          color: textColor,
        },
      },
    },
    scales: {
      x: { ticks: { color: textColor }, grid: { color: '#85929E' } },
      y: { title: { display: true, color: textColor, text: 'Notificaciones leves' }, ticks: { color: textColor }, grid: { color: '#85929E' } }
    }
  }
  });


</script>

{% endblock javascripts %}